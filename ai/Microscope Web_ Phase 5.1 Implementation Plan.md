# **Microscope Web: Phase 5.1 Implementation Plan**

Focus: Initial Screen (Lobby), Session Setup, and Settings Tab implementation.  
Prerequisite: Phase 4.1 (Metadata Tab logic) is complete, and Y.js synchronization exists.

## **1\. Objectives**

1. **Lobby UI:** Implement the initial screen to collect username and session choice.  
2. **Session Creation/Joining:** Connect the UI buttons to the ConnectionManager to generate or use Room IDs (UUIDs).  
3. **Settings Tab:** Implement the tab to display and allow copying of the session's join code (UUID/Room ID).

## **2\. Technical Strategy: Room ID Management**

Since we want to support both manual codes and direct links:

* **Room ID Format:** We will use the full UUID generated by the y-webrtc provider as the unique Room ID.  
* **Join Code:** The Settings Tab will display this full UUID, and the user can copy it.  
* **Initial Check:** The App.tsx component will check for URL parameters first (?room=...). If none exist, it renders the Lobby.

## **3\. Step-by-Step Implementation**

### **Step 1: The Initial Screen Component (Lobby.tsx)**

* **Action:** Create Lobby.tsx. This component is the default render until the connection is established.  
* **Username Input:**  
  * **Default Logic:** Implement a function generateDefaultUsername() that returns "Guest" \+ Math.floor(Math.random() \* 90\) \+ 10\.  
  * **Input:** An editable text field for the username, pre-populated with the default. Store the value locally.  
* **Join/Host Controls:**  
  1. **Host Button:** onClick triggers handleHostSession().  
  2. **Join Button:** onClick triggers handleJoinSession(). Disabled if the join code textbox is empty.  
  3. **Join Code Textbox:** An editable input field (bound to a local state variable) for entering the target Room ID.

### **Step 2: Connection Manager Integration**

* **Action:** Update ConnectionManager.ts (or the logic in useYjs.ts).  
* **handleHostSession(username):**  
  1. Generate a new unique Room ID (UUID).  
  2. Store username locally.  
  3. Call YjsProvider.connect(newRoomId).  
  4. Set up the Host/Peer metadata (as defined in Phase 5.1, Step 1).  
* **handleJoinSession(username, code):**  
  1. Validate the input code (must be a valid UUID format or a simplified slug, if supported).  
  2. Store username locally.  
  3. Call YjsProvider.connect(code).

### **Step 3: The Settings Tab**

* **Action:** Create SettingsTab.tsx. This will be the final tab in the Sideboard component (as defined in Phase 3).  
* **Content:**  
  1. **Current Session ID Display:** Display the active YjsProvider.roomId.  
  2. **Copy Button:** A button next to the ID that uses the browser's Clipboard API (document.execCommand('copy') for compatibility) to copy the ID to the user's clipboard.  
  3. **Direct Link Display:** Display the full sharable URL (\[App URL\]?room=\[RoomID\]).  
  4. *(Optional for Phase 5.2):* Theme/Layout settings controls (as defined in Phase 4).

### **Step 4: Application State Flow**

* **Action:** Update App.tsx main render logic.  
* **Logic:**  
  if (connectionStatus \=== 'disconnected' && \!initialRoomIdFromUrl) {  
      return \<Lobby /\>;  
  } else if (connectionStatus \=== 'connecting' || connectionStatus \=== 'connected') {  
      return \<MainCanvas /\>; // Renders Sideboard which contains SettingsTab  
  }

* **Result:** The application will transition from the simple **Lobby** view to the complex **Canvas/Sideboard** view immediately upon successful connection.

## **4\. Ambiguities & Future Risks**

| Issue | Resolution | Risk/Note |
| :---- | :---- | :---- |
| **Join Code Format** | **Resolution:** For Phase 5.2, we will use the full **UUID** as the join code. | **Risk:** UUIDs are long and hard to type. Phase 6 should implement the **3-Word Slug** for user-friendliness (requires a separate storage/translation mechanism). |
| **Username Persistence** | The username is only set *once* upon entry. | **Risk:** If a user disconnects/reconnects without refreshing the page, their PeerID may change, but their metadata should reflect the same username. The system needs to ensure the local username is associated with the new PeerID if re-connecting to the same room. |

